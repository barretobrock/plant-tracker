{% extends 'base.html' %}
{% block head %}
    {{ super() }}
{% endblock %}
{% block content %}
    {% set waterreq_class = "waterreq" %}

    <div class="row">
        <div>
            <div class="row title-block">
                <div class="col">
                    <div class="species-title">
                        {{data.scientific_name}}
                        {% if data.is_native is none %}
                            {% set native_text = "native?" %}
                            {% set native_color = "warning" %}
                        {% elif data.is_native %}
                            {% set native_text = "native" %}
                            {% set native_color = "success" %}
                        {% else %}
                            {% set native_text = "not native" %}
                            {% set native_color = "danger" %}
                        {% endif %}
                        <span class="species-badge badge rounded-pill bg-{{ native_color }}">{{ native_text }}</span>
                        {% for item_name, item_dict in icon_class_map.items() %}
                            <i class="icon {{ item_dict.map[item_dict.value] }} {{ item_dict.addl_class}}" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ item_name }} - {{ item_dict.value }}"></i>
                        {% endfor %}
                    </div>
                    <div class="species-subtitle">({{data.common_name}})</div>
                </div>
            </div>

        </div>
    </div>
    <div class="row">
        <div class="col my-2">
            <div class="float-start">
                <a type="button" class="btn btn-sm btn-outline-success position-relative" href="/plant/by_species/{{ data.species_id }}/all">
                    Plants
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">
                        {{data.plants|length}}
                        <span class="visually-hidden">plants</span>
                    </span>
                </a>
            </div>
            <div class="float-end">
                <a type="button" class="btn btn-outline-warning btn-sm" href="#"><i class="bi-wrench"> Maintenance</i></a>
                <a type="button" class="btn btn-outline-primary btn-sm" href="/species/{{ data.species_id }}/edit"><i class="bi-pencil"></i> Edit</a>
                <a type="button" class="btn btn-outline-danger btn-sm" href="/species/{{ data.species_id }}/delete"><i class="bi-trash"></i> Delete</a>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card-body shadow p-3 mb-5 rounded">
                <h4 class="card-title">Basic Info</h4>
                <p class="card-text">
                    <span></span>
                </p>
                <div class="card-text">
                {% for item_label, item_dict in basic_info.items() %}
                    <div class="info-line">
                        <strong>{{ item_label }}: </strong>
                        {{ item_dict.value }}
                    </div>
                {% endfor %}
                </div>
                <hr>
                <h5 class="card-title">
                    Alternate Names
                    <span class="float-end">
                        <a type="button" href="/species/{{data.species_id}}/altname/add" class="btn btn-outline-success btn-sm"><i class="bi-plus"></i>Add Name</a>
                    </span>
                </h5>

                <div class="card-text">
                    {% for alt_name in data.alternate_names %}
                        <span>{{ alt_name.name }}</span>
                        <a type="button" class="btn btn-outline-primary btn-sm inline-button"  href="/species/{{ data.species_id }}/altname/{{ alt_name.alternate_name_id }}/edit" ><i class="bi-pencil"></i></a>
                        <a type="button" class="btn btn-outline-danger btn-sm inline-button"  href="/species/{{ data.species_id }}/altname/{{ alt_name.alternate_name_id }}/delete" ><i class="bi-trash"></i></a>
                    {% endfor %}
                </div>
                <hr>
                <h5 class="card-title">Bloom Info</h5>
                <div class="card-text">
                    <div class="info-line">
                        <strong>Start Month: </strong>{{ data.bloom_start_month }}
                        <strong>End Month: </strong>{{ data.bloom_end_month }}
                    </div>

                    {% set bloom_start = data.bloom_start_month if data.bloom_start_month else 0 %}
                    {% set bloom_end = data.bloom_end_month if data.bloom_end_month else 0 %}
                    <div class="bloom-months-section">
                        {% for m in 'j,f,m,a,m,j,j,a,s,o,n,d'.split(',') %}
                            {% if bloom_start <= loop.index <= bloom_end %}
                                {% set bloomclass = "bg-success" %}
                            {% else %}
                                {% set bloomclass = "bg-light" %}
                            {% endif %}
                            <span class="badge {{ bloomclass }} bloom-badge">{{ m.upper() }}</span>
                        {% endfor %}
                    </div>

                    <div class="info-line">
                        <p>{{ data.bloom_notes if data.bloom_notes else '' }}</p>
                    </div>

                </div>

            </div>
        </div>
        <div class="col">
            <div class="card-body shadow p-3 mb-5 rounded">
                <h4 class="card-title">
                    Photos
                    <span class="float-end">
                        <a type="button" href="/species/{{data.species_id}}/image/add" class="btn btn-outline-success btn-sm"><i class="bi-plus-circle-fill"></i></a>
                    </span>
                </h4>
                <div id="plant-pic-carousel" class="carousel slide" data-bs-slide="carousel">
                    <div class="carousel-inner">
                        {% if data.images %}
                            {% for img in data.images %}
                                <div class="carousel-item active">
                                    <img src="{{ img.image_path }}" class="d-block w-100" alt="plant-pic">
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="carousel-item active">
                                <img src="/images/winecup.jpg" class="d-block w-100" alt="plant-pic">
                            </div>
                        {% endif %}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col">
            <div class="card-body shadow p-3 mb-5 rounded">
                <h4 class="card-title">
                    Scheduled Maintenance
                    <span class="float-end">
                        <a type="button" href="/species/{{data.species_id}}/scheduled_maintenance/add" class="btn btn-outline-success btn-sm"><i class="bi-plus-circle-fill"></i></a>
                    </span>
                </h4>
                 <table class="table table-sm table-bordered table-striped table-dark">
                     <thead>
                        <tr>
                            <th>Type</th>
                            <th>Freq</th>
                            <th>Start</th>
                            <th>End</th>
                            <th>Notes</th>
                            <th></th>
                        </tr>
                     </thead>
                     {% for maint in data.scheduled_maintenance_logs %}
                        <tr class="{{ '' if maint.is_enabled else 'disabled' }}">
                            <td>{{ maint.maintenance_type }}</td>
                            <td>{{ maint.maintenance_frequency }}</td>
                            <td>{{ maint.maintenance_period_start.strftime("%b %d") }}</td>
                            <td>{{ maint.maintenance_period_end.strftime("%b %d") }}</td>
                            <td>{{ maint.notes }}</td>
                            <td>
                                <a type="button" class="btn btn-outline-primary btn-sm inline-button"  href="/species/{{ data.species_id }}/scheduled_maintenance/{{ maint.maintenance_schedule_id }}/edit" ><i class="bi-pencil"></i></a>
                                <a type="button" class="btn btn-outline-danger btn-sm inline-button"  href="/species/{{ data.species_id }}/scheduled_maintenance/{{ maint.maintenance_schedule_id }}/delete" ><i class="bi-trash"></i></a>
                            </td>
                        </tr>
                     {% endfor %}
                 </table>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card-body shadow p-3 mb-5 rounded">
                <h4 class="card-title">Additional Info</h4>
                <p class="card-text">
                    {% for item_label, item_dict in addl_info.items() %}
                        <span><strong>{{ item_label }}: </strong></span>
                        <span>{{ item_dict.value }}</span>
                    {% endfor %}
                </p>

            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card-body shadow p-3 mb-5 rounded">
                <h4 class="card-title">Map</h4>
                <svg></svg>
            </div>
        </div>
    </div>
{% endblock %}